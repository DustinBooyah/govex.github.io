<!DOCTYPE html>
<meta charset="utf-8">
<title>GovEx Sunburst Chart</title>

<style>
@import ("/style.css");
path {
  stroke: #000;
  stroke-width: 1.5;
  cursor: pointer;
}

text {
  font: 11px sans-serif;
  cursor: pointer;
}

h1 {
  text-align: center;
  margin: .5em 0;
}

.wrapper {
  margin-left: 120px;
}

blockquote {
  width: 720px;
}

p#intro {
  margin-left: 120px;
}

</style>

<h1>GovEx Sunburst Chart</h1>
<script src="d3-master/d3.min.js"></script>
<!-- <script src="pipeline_sunburst.js"></script> -->
<script src="DataStructures.Tree-master/js/lib/DataStructures.Tree.js"></script>

<script>
! function() {
    function t(n, e) {
        return n === e ? !0 : n.children ? n.children.some(function(n) {
            return t(n, e)
        }) : !1
    }

    function n(t) {
        if (t.children) {
            var e = t.children.map(n),
                r = d3.hsl(e[0]),
                a = d3.hsl(e[1]);
            return d3.hsl((r.h + a.h) / 2, 1.2 * r.s, r.l / 1.2)
        }
        return t.colour || "#fff"
    }

    function e(t) {
        var n = r(t),
            e = d3.interpolate(d.domain(), [t.x, t.x + t.dx]),
            a = d3.interpolate(u.domain(), [t.y, n]),
            i = d3.interpolate(u.range(), [t.y ? 20 : 0, o]);
        return function(t) {
            return function(n) {
                return d.domain(e(n)), u.domain(a(n)).range(i(n)), x(t)
            }
        }
    }

    function r(t) {
        return t.children ? Math.max.apply(Math, t.children.map(r)) : t.y + t.dy
    }

    function a(t) {
        return .299 * t.r + .587 * t.g + .114 * t.b
    }
    var i = 840,
        l = i,
        o = i / 2,
        d = d3.scale.linear().range([0, 2 * Math.PI]),
        u = d3.scale.pow().exponent(1.3).domain([0, 1]).range([0, o]),
        c = 5,
        s = 1e3,
        h = d3.select("#vis");
    h.select("img").remove();
    var f = h.append("svg").attr("width", i + 2 * c).attr("height", l + 2 * c).append("g").attr("transform", "translate(" + [o + c, o + c] + ")");
    h.append("p").attr("id", "intro").text("Click to zoom!");
    var p = d3.layout.partition().sort(null).value(function(t) {
            return 5.8 - t.depth
        }),
        x = d3.svg.arc().startAngle(function(t) {
            return Math.max(0, Math.min(2 * Math.PI, d(t.x)))
        }).endAngle(function(t) {
            return Math.max(0, Math.min(2 * Math.PI, d(t.x + t.dx)))
        }).innerRadius(function(t) {
            return Math.max(0, t.y ? u(t.y) : t.y)
        }).outerRadius(function(t) {
            return Math.max(0, u(t.y + t.dy))
        });
        d3.csv("data.csv", function(data){
        var tree = DataStructures.Tree.createFromFlatTable(data),
                   root = tree.toSimpleObject(function(objectToDecorate, originalNode) {
                        objectToDecorate.size = originalNode.size;
                        if (objectToDecorate.children && objectToDecorate.children.length == 0) {
                            delete objectToDecorate.children;
                        }
                        return objectToDecorate;
                    });
      });
}();
</script>


<div id="vis"></div>

<!-- <div class="wrapper">
<h2>Sunburst Trees</h2>
<p>This is an example of using <a href="http://github.com/mbostock/d3/wiki/Partition-Layout">d3.layout.partition</a> to generate a zoomable sunburst tree derived from hierarchical data.  A <a href="http://www.cc.gatech.edu/gvu/ii/sunburst/">sunburst tree</a> is a radial space-filling visualisation, analagous to an icicle tree.
<h2>Colours</h2>
<p>The original colours appear to have been selected by the designer, as opposed to matching any standard colour name palettes.  So I painstakingly copied the colours from the outermost (leaf) nodes of the tree to match the original.
<p>The inner node colours are calculated automatically by taking the average of the two child nodes in HSL colour space.
<h2>Labels</h2>
<p>The label colour of black or light grey is automatically chosen by calculating the <a href="http://www.w3.org/WAI/ER/WD-AERT/#color-contrast">colour brightness</a> of each node.  If a label has more than one word, it is split into two lines and placed equidistant to the centre of the segment.
<h2>Credits</h2>
<p>Built with <a href="http://d3js.org">D3.js</a>.
  Sunburst zooming based on an <a href="http://bl.ocks.org/mbostock/4348373">example</a> by <a href="http://bost.ocks.org/mike">Mike Bostock</a>.
<p>Thanks to Bart Mesuere for suggesting a performance optimisation for Firefox.

<script>
  if (top != self) top.location.replace(location);
</script>

<p class="copyright">&copy; <a href="http://www.jasondavies.com/">Jason Davies</a> | <a href="../privacy/">Privacy Policy</a>. -->
