<!DOCTYPE html>
<meta charset="utf-8">
<title>GovEx Sunburst Chart</title>

<style>
@import ("/style.css");
path {
  stroke: #000;
  stroke-width: 1.5;
  cursor: pointer;
}

text {
  font: 11px sans-serif;
  cursor: pointer;
}

h1 {
  text-align: center;
  margin: .5em 0;
}

.wrapper {
  margin-left: 120px;
}

blockquote {
  width: 720px;
}

p#intro {
  margin-left: 120px;
}

</style>

<h1>GovEx Sunburst Chart</h1>
<div id="vis"></div>
<script src="d3-master/d3.min.js"></script>
<script src="pipeline_sunburst.js"></script>
<script type="text/javascript" src="DataStrctures.Tree-master/js/lib/DataStructures.Tree.js"></script>

<script>
d3.csv("data.csv", function(data){
var tree = DataStructures.Tree.createFromFlatTable(data),
           root = tree.toSimpleObject(function(objectToDecorate, originalNode) {
                objectToDecorate.size = originalNode.size;
                if (objectToDecorate.children && objectToDecorate.children.length == 0) {
                    delete objectToDecorate.children;
                }
                return objectToDecorate;
            });
console.log(JSON.stringify(root));

  //*************************************************
  // THE FUNCTION
  //*************************************************
  function genJSON(csvData, groups) {

    var genGroups = function(data) {
      return _.map(data, function(element, index) {
        return { name : index, children : element };
      });
    };

    var nest = function(node, curIndex) {
      if (curIndex === 0) {
        node.children = genGroups(_.groupBy(csvData, groups[0]));
        _.each(node.children, function (child) {
          nest(child, curIndex + 1);
        });
      }
      else {
        if (curIndex < groups.length) {
          node.children = genGroups(
            _.groupBy(node.children, groups[curIndex])
          );
          _.each(node.children, function (child) {
            nest(child, curIndex + 1);
          });
        }
      }
      return node;
    };
    return nest({}, 0);
  }
  //*************************************************
  // CALL THE FUNCTION
  //*************************************************


  var preppedData = genJSON(data, ['WWC Standard',	'Average Joe standard',	'GovEx Book',	'GovEx Chapter',	'GovEx Verse',	'Pre/Post Metric'])
  console.log(preppedData);
  //*************************************************
  // LOAD THE PREPPED DATA IN D3
  //*************************************************
  var path = svg.datum(preppedData).selectAll("path")
    .data(partition.nodes)
  .enter().append("path")
    .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
    .attr("d", arc)
    .attr("class", function(d) { return (d.children ? d : d.parent).name; })
    .style("stroke", "#fff")
    .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
    .style("fill-rule", "evenodd")

});
</script>

<div class="wrapper">
<h2>Sunburst Trees</h2>
<p>This is an example of using <a href="http://github.com/mbostock/d3/wiki/Partition-Layout">d3.layout.partition</a> to generate a zoomable sunburst tree derived from hierarchical data.  A <a href="http://www.cc.gatech.edu/gvu/ii/sunburst/">sunburst tree</a> is a radial space-filling visualisation, analagous to an icicle tree.
<h2>Colours</h2>
<p>The original colours appear to have been selected by the designer, as opposed to matching any standard colour name palettes.  So I painstakingly copied the colours from the outermost (leaf) nodes of the tree to match the original.
<p>The inner node colours are calculated automatically by taking the average of the two child nodes in HSL colour space.
<h2>Labels</h2>
<p>The label colour of black or light grey is automatically chosen by calculating the <a href="http://www.w3.org/WAI/ER/WD-AERT/#color-contrast">colour brightness</a> of each node.  If a label has more than one word, it is split into two lines and placed equidistant to the centre of the segment.
<h2>Credits</h2>
<p>Built with <a href="http://d3js.org">D3.js</a>.
  Sunburst zooming based on an <a href="http://bl.ocks.org/mbostock/4348373">example</a> by <a href="http://bost.ocks.org/mike">Mike Bostock</a>.
<p>Thanks to Bart Mesuere for suggesting a performance optimisation for Firefox.

<script>
  if (top != self) top.location.replace(location);
</script>

<p class="copyright">&copy; <a href="http://www.jasondavies.com/">Jason Davies</a> | <a href="../privacy/">Privacy Policy</a>.
